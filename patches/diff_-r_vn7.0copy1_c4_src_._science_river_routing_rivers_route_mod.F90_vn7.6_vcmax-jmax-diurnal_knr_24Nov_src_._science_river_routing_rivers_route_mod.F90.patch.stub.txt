Patch stub generated: 2025-11-25T12:09:12.248265 UTC

HEADER:
diff -r vn7.0copy1_c4/src/./science/river_routing/rivers_route_mod.F90 vn7.6_vcmax-jmax-diurnal_knr_24Nov/src/./science/river_routing/rivers_route_mod.F90

SUMMARY:
  - added lines (>): 83
  - removed lines (<): 118
  - only in one tree: False

RECOMMENDATIONS:
- Manual review recommended; inspect the preview below.

DIFF PREVIEW:
diff -r vn7.0copy1_c4/src/./science/river_routing/rivers_route_mod.F90 vn7.6_vcmax-jmax-diurnal_knr_24Nov/src/./science/river_routing/rivers_route_mod.F90
19c19
< !-----------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
29,37c29,33
< !###############################################################################
< ! subroutine rivers_drive
< ! Driver routine for runoff routing by a kinematic wave model.
< 
< SUBROUTINE rivers_drive( global_land_pts, sub_runoffin, surf_runoffin,         &
<                          runoff_out, rivflow, riverout_rgrid,                  &
<                        !  imported rivers arrays
<                          rivers)
< !-------------------------------------------------------------------------------
---
> !##############################################################################
> 
> SUBROUTINE rivers_route_rp(rivers)
> 
> !------------------------------------------------------------------------------
40c36
< !   Perform the routing of surface and sub-surface runoff defined on landpts
---
> !   Perform the routing of surface and sub-surface runoff defined on riverpts
42,43c38,39
< !   This routine regrids the total surface runoff to the river grid and passes
< !   it to the RFM or TRIP routines to be routed.
---
> !   This passes the total surface runoff in the river grid to the RFM or TRIP
> !   routines to be routed.
45c41
< !-------------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
52,55d47
< USE rivers_regrid_mod, ONLY:                                                   &
< !  imported procedures
<      landpts_to_rivpts, rivpts_to_landpts
< 
70,92c62,64
< !-------------------------------------------------------------------------------
< ! Scalar arguments with intent(in)
< INTEGER, INTENT(IN) :: global_land_pts
<                              ! Size of GLOBAL runoff arrays on land points
< ! Array arguments with intent(in)
< REAL(KIND=real_jlslsm), INTENT(IN) :: sub_runoffin(global_land_pts)
<                              ! Average rate of sub surface runoff since
<                              ! last rivers call on land_pts in kg m-2 s-1
< REAL(KIND=real_jlslsm), INTENT(IN) :: surf_runoffin(global_land_pts)
<                              ! Average rate of surface runoff since last
<                              ! rivers call on land_pts in kg m-2 s-1
< 
< ! Array arguments with intent(out)
< REAL(KIND=real_jlslsm), INTENT(OUT) :: runoff_out(global_land_pts)
<                              ! Total runoff diagnostic on land_pts
<                              ! in kg m-2 s-1
< REAL(KIND=real_jlslsm), INTENT(OUT) :: rivflow(global_land_pts)
<                              ! River flow diagnostic on land_pts
<                              ! in kg m-2 s-1
< REAL(KIND=real_jlslsm), INTENT(OUT) :: riverout_rgrid(np_rivers)
<                              ! River outflow into the ocean on river grid
<                              ! in kg s-1
< 
---
> !------------------------------------------------------------------------------
> ! Arguments with INTENT(IN OUT)
> !------------------------------------------------------------------------------
94a67
> !------------------------------------------------------------------------------
96c69,70
< INTEGER :: l, ip             !  loop counter
---
> !------------------------------------------------------------------------------
> INTEGER :: ip                !  loop counter
97a72
> !------------------------------------------------------------------------------
98a74
> !------------------------------------------------------------------------------
103,130c79
< !-------------------------------------------------------------------------------
< ! Initialisation
< !-------------------------------------------------------------------------------
< DO ip = 1, np_rivers
<   rivers%rflow_rp(ip)    = 0.0
<   baseflow(ip)   = 0.0
<   riverout_rgrid(ip) = 0.0
<   rivers%rrun_sub_surf_rp(ip) = 0.0
<   rivers%rrun_surf_rp(ip) = 0.0
< END DO
< 
< DO l = 1, global_land_pts
<   rivflow(l)    = 0.0
<   runoff_out(l) = 0.0
< END DO
< 
< !-------------------------------------------------------------------------------
< ! Regrid surface and subsurface runoff from land points to rivers points
< !-------------------------------------------------------------------------------
< CALL landpts_to_rivpts( global_land_pts, sub_runoffin,                         &
<                         np_rivers, rivers%rrun_sub_surf_rp,                    &
<                         rivers%il_river_grid, rivers%ir_land_grid,             &
<                         rivers%rivers_index_rp )
< CALL landpts_to_rivpts( global_land_pts, surf_runoffin,                        &
<                         np_rivers, rivers%rrun_surf_rp,rivers%il_river_grid,   &
<                         rivers%ir_land_grid, rivers%rivers_index_rp )
< 
< !-------------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
132c81
< !-------------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
137c86
<                          rivers%rflow_rp, baseflow, riverout_rgrid,            &
---
>                          rivers%rflow_rp, baseflow,                            &
142c91
<                           rivers%rflow_rp, baseflow, riverout_rgrid,           &
---
>                           rivers%rflow_rp, baseflow, rivers%rivers_outflow_rp, &
152c101
< !-------------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
164,174c113
< !-------------------------------------------------------------------------------
< !   Regrid from rivers to land grid
< !------------------------------------------------------------------------------
< CALL rivpts_to_landpts( np_rivers, rivers%rflow_rp, global_land_pts, rivflow,  &
<                         rivers%il_river_grid, rivers%ir_land_grid,             &
<                         rivers%rivers_index_rp )
< CALL rivpts_to_landpts( np_rivers, rivers%rrun_rp, global_land_pts,            &
<                         runoff_out, rivers%il_river_grid, rivers%ir_land_grid, &
<                         rivers%rivers_index_rp )
< 
< END SUBROUTINE rivers_drive
---
> END SUBROUTINE rivers_route_rp
176c115
< !###############################################################################
---
> !##############################################################################
180c119
< !-----------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
191c130
< !-----------------------------------------------------------------------------
---
> !------------------------------------------------------------------------------
211c150,152
< ! Array arguments with intent(in)
---
> !------------------------------------------------------------------------------
> ! Array arguments with INTENT(IN)
> !------------------------------------------------------------------------------
214c155,158
< ! Array arguments with intent(in)

INSTRUCTIONS:
  1) Edit the corresponding .patch file: patches/diff_-r_vn7.0copy1_c4_src_._science_river_routing_rivers_route_mod.F90_vn7.6_vcmax-jmax-diurnal_knr_24Nov_src_._science_river_routing_rivers_route_mod.F90.patch
     - Place a git-style unified diff (``--- a/..., +++ b/...``) there.
  2) Create small focused patches (one logical change per file).
  3) Run apply_patches.sh (after filling patches) from the repository root.

